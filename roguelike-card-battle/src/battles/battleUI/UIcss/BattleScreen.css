/* BattleScreen.css */

/* =========================================
   基盤レイアウト & テーマ変数受け皿
   ========================================= */
.battle-screen {
  width: 100vw;
  height: 100vh; /* 画面いっぱい */
  background: linear-gradient(var(--theme-bg));
  border: 0.3vh solid var(--theme-accent); /* 枠線もvhで */
  border-radius: 1vh; /* 全画面推奨なら不要だが残すなら相対単位で */
  box-shadow: 0 0 4vh var(--theme-glow), inset 0 0 6vh rgba(0, 0, 0, 0.5);
  position: relative;
  display: flex;
  flex-direction: column;
  padding: 2vh 2vw;
  gap: 2vh;
  overflow: hidden;
  color: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  box-sizing: border-box; /* パディングを含める */
}


.turn-message-slide {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 4vh 6vw;
  width: 40vw;
  z-index: 1000;
  background: rgba(0, 0, 0, 0.9);
  border: 0.4vh solid var(--theme-accent);
  border-radius: 2vh;
  box-shadow: 0 0 6vh var(--theme-glow), inset 0 0 3vh rgba(0, 0, 0, 0.8);
  animation: turnMessageAppear 2.5s ease-in-out forwards;
  pointer-events: none;
}

.turn-message-text {
  font-size: 5vh; /* 画面高さ基準 */
  font-weight: bold;
  color: var(--theme-accent);
  text-shadow: 0 0 2vh var(--theme-glow);
  text-align: center;
  letter-spacing: 0.5vw;
}

@keyframes turnMessageAppear {
  0% { opacity: 0; transform: translate(-50%, -50%) translateX(100vw); }
  40%, 60% { opacity: 1; transform: translate(-50%, -50%) translateX(0); }
  100% { opacity: 0; transform: translate(-50%, -50%) translateX(-100vw); }
}

/* =========================================
   ヘッダー (深度情報)
   ========================================= */
.battle-header {
  position: absolute;
  top: 2vh;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1vh;
  z-index: 10;
}

.depth-info {
  font-size: 3vh;
  font-weight: bold;
  color: var(--theme-accent);
  text-shadow: 0 0 1vh var(--theme-glow);
  text-transform: uppercase;
  letter-spacing: 0.2vw;
}

.depth-controls {
  display: flex;
  gap: 0.5vw;
}

.depth-btn {
  padding: 0.5vh 1.5vw;
  background: rgba(0, 0, 0, 0.5);
  border: 0.1vh solid var(--theme-accent);
  border-radius: 0.5vh;
  color: #fff;
  font-size: 1.5vh;
  font-weight: bold;
  cursor: pointer;
}
.depth-btn.active {
  background: var(--theme-accent);
}

/* =========================================
   バトルフィールド (敵・プレイヤーエリア)
   ========================================= */
.battle-field {
  flex: 1; /* 残りの高さを埋める */
  display: flex;
  flex-direction: row;
  justify-content: space-around; /* 左右に配置 */
  align-items: center;
  width: 100%;
  height: 35%; /* 画面上半分を使う */
  margin: 0;
}

.player-section {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 2vh;
  width: 35%; /* 画面幅の1/2 */
  height: 85%;
  position: relative;
  bottom: 10vh;
  right: -2vh
}
.player-field{
  flex: 0.75;
  gap: 1.5vh;
align-items: center;
  display: flex;
  flex-direction: column;
}

.energy-and-ability {
  flex: 0.25;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2vh;

}

.character-name {
  font-size: 3vh;
  font-weight: bold;
  text-shadow: 0 0 1vh var(--theme-glow);
}

.character-visual {
  width: 20vh;
  height: 20vh;
  border-radius: 1.5vh;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10vh; /* 絵文字サイズ */
}
/* 画像を使う場合の調整 */
.character-visual img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 1.5vh;
}
.enemy-image{
  filter: drop-shadow(0 0 1vh rgb(193, 55, 55));
}
.player-image{
  filter: drop-shadow(0 0 1vh rgb(48, 115, 191));
}
/* ステータスバー類 */
.status-container {
  position: relative;
  left: -4%;
  width: 80%;
}

.status-row {
  display: flex;
  justify-content: space-between;
  font-size: 1.78vh;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.5vh;
}
.status-label{
  text-align: center;
  min-width: 9.2vh;
}
.guard-num{
  color: #88ccff;
  text-shadow: #66aaff 0 0 0.5vh;
}
.ap-num{
  color: #ffaa44;
  text-shadow: #ff9922 0 0 0.5vh;
}
.hp-num{
  color: #d94a4a;
  text-shadow: rgb(226, 71, 71) 0 0 0.5vh;
}
.bar-frame {
  flex: 1;;
  margin-block:0.4vh;
  height: 1.75vh;
  margin-left: 1vh;
  background: rgba(0, 0, 0, 0.5);
  border: 0.1vh solid rgba(255, 255, 255, 0.2);
  border-radius: 0.5vh;
  overflow: hidden;
}

.bar-gauge {
  width: 70%;
  height: 100%;
  transition: width 0.3s ease;
}
.bar-gauge.guard { background: linear-gradient(90deg, #4488cc 0%, #6699ff 100%); }
.bar-gauge.ap { background: linear-gradient(90deg, #cc8844 0%, #ffaa44 100%); }
.bar-gauge.hp { background: linear-gradient(90deg, #d94a4a 0%, #ff6b6b 100%); }

.next-action { margin-top: 1vh; text-align: center; }
.action-value { font-size: 2.5vh; color: #d94a4a; font-weight: bold; }

/* =========================================
   手札エリア (Hand Area) - スタック対応
   ========================================= */
.hand-container {
  position: absolute;
  bottom: 2vh;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  justify-content: center;
  align-items: flex-end;
  /* 重なりを作るためのマイナスマージンはCard側で制御、あるいはjustify-contentで詰める */
  width: 65%;
  height: 40%; /* 手札エリアの高さ */
  z-index: 100;
  /* エリア確認用の背景（不要なら透明度下げるか削除） */
  /* background: rgba(0, 0, 0, 0.2); 
  border-radius: 2vh; */
  padding-bottom: 2vh;
}

/* 個別のカードラッパー（回転や位置調整用） */
.card-wrapper {
  /* JSから --rot (回転), --y (Y軸) が渡ってくる前提 */
  position: relative;
  
  /* カードの基本サイズ (レスポンシブ) */
  width: 13vh; /* 高さに依存させることでアスペクト比を維持 */
  aspect-ratio: 2 / 3;
  
  /* スタックさせるためのネガティブマージン */
  margin-left: -2vh; 
  /* 最初のカードはマージンなし */
  &:first-child { margin-left: 0; }

  transform-origin: center bottom;
  
  /* 通常時の配置（JS計算値） */
  transform: translateY(var(--y)) rotate(var(--rot));
  transition: transform 0.2s cubic-bezier(0.33, 1, 0.68, 1), margin 0.2s;
  cursor: pointer;
  
  /* アニメーション用 */
  animation-fill-mode: both; 
}

/* --- ホバーアクション（浮き上がり） --- */
.card-wrapper:hover {
  z-index: 1000 !important; /* 最前面へ */
  /* 回転を戻し、上に持ち上げ、少し拡大 */
  transform: translateY(-1vh) rotate(0deg) scale(1.2) !important;
  /* 隣のカードとの間隔を少し広げる（オプション） */
  margin-left: 1vh;
  margin-right: 1vh;
}

/* ホバーしたカードの右隣のカード（少し右に避ける演出） */
.card-wrapper:hover + .card-wrapper {
  transform: translateX(4vh) translateY(var(--y)) rotate(var(--rot));
}

/* =========================================
   カード本体 (Card Component)
   ========================================= */
.card {
  width: 120%;
  height: 120%;
  background: linear-gradient(145deg, var(--theme-primary) 0%, var(--theme-secondary) 50%, var(--theme-primary) 100%);
  border: 0.3vh solid rgba(60, 60, 60, 0.5);
  border-radius: 1vh;
  padding: 1vh;
  position: relative;
  display: flex;
  flex-direction: column;
  box-shadow: 0 0.5vh 2vh rgba(0, 0, 0, 0.8), inset 0 0.5vh 1vh rgba(0, 0, 0, 0.3);
}

.card.playable { border-color: var(--theme-accent); }
.card.unplayable { opacity: 0.6; filter: grayscale(0.5); }

/* コスト */
.card-cost {
  position: absolute;
  top: -1.5vh;
  left: -1.5vh;
  width: 4vh;
  height: 4vh;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 2.5vh;
  color: #878686;
  border: 0.3vh solid #000;
  box-shadow: 0 0 1.5vh var(--theme-glow);
  background: var(--category-bg, #333); 
  z-index: 5;
}

/* カテゴリバッジ */
.card-badge {
  position: absolute;
  top: 0.5vh;
  right: 0.5vh;
  padding: 0.3vh 0.6vh;
  border-radius: 0.5vh;
  font-size: 1.2vh;
  font-weight: bold;
  text-transform: uppercase;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: var(--category-bg-alpha, #333);
}

.card-name {
  font-size: 1.8vh;
  font-weight: bold;
  text-align: center;
  margin-top: 2vh;
  margin-bottom: 0.5vh;
  text-shadow: 0 0 1vh var(--theme-glow);
  /* 長い名前対応 */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card-desc-box {
  flex: 1;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 0.8vh;
  border: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 0.5vh;
  overflow: hidden;
}

.card-desc-text {
  font-size: 1.28vh;
  text-align: center;
  line-height: 1.3;
  color: rgba(255, 255, 255, 0.9);
}

.card-power {
  margin-top: 0.5vh;
  font-size: 1.6vh;
  font-weight: bold;
  color: var(--theme-accent);
}

/* マスタリー */
.mastery-info { margin-top: auto; }
.mastery-labels { display: flex; justify-content: space-between; font-size: 1.2vh; margin-bottom: 0.2vh; }
.mastery-bar-bg { width: 100%; height: 0.6vh; background: rgba(0,0,0,0.6); border-radius: 0.3vh; overflow: hidden; }
.mastery-bar-fill { height: 100%; background: linear-gradient(90deg, var(--theme-secondary), var(--theme-accent)); }

/* 深度ドット */
.depth-dots { display: flex; justify-content: center; gap: 0.4vh; margin-top: 0.5vh; }
.depth-dot { width: 1vh; height: 1vh; border-radius: 50%; border: 1px solid rgba(255,255,255,0.3); background: rgba(0,0,0,0.5); }
.depth-dot.active { background: var(--theme-accent); box-shadow: 0 0 0.5vh var(--theme-glow); border-color: white; }

/* =========================================
   デッキ・捨て札・コントロール
   ========================================= */
.pile-icon {
  position: absolute;
  bottom: 4vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1vh;
  cursor: pointer;
  transition: transform 0.2s;
  z-index: 50;
  font-size: 2.3vh;
  font-weight: bold;
}
.pile-icon:hover { transform: scale(1.1); }
.pile-icon.draw { right: 3vw; }
.pile-icon.discard { left: 3vw; }

.pile-visual {
  width: 7vh;
  height: 9.5vh;
  background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
  border: 0.3vh solid var(--theme-accent);
  border-radius: 1vh;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 4vh;
  box-shadow: 0 0.5vh 1.5vh rgba(0,0,0,0.6);
}
.pile-count { font-size: 2vh; font-weight: bold; text-shadow: 0 0 0.5vh var(--theme-glow); }

.pile-visual:hover{
  border-color: var(--theme-bg);
  background:linear-gradient(135deg, var(--theme-hover));
}
/* エナジー & ターン終了 */
.energy-display {
  gap: 0.8vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1vh 1vw;
  border: 0.2vh solid var(--theme-accent);
  border-radius: 1vh;
  font-size: 2vh;
  font-weight: bold;
  background: rgba(0,0,0,0.6);
  z-index: 50;
}
.energy-label { font-size: 1.5vh; margin-bottom: 0.5vh; }
.energy-orbs { display: flex; gap: 0.8vh; }
.orb {
  width: 3.5vh;
  height: 3.5vh;
  border-radius: 50%;
  border: 0.3vh solid #555;
  background: #222;
}
.orb.filled {
  background: radial-gradient(circle, var(--theme-accent), var(--theme-secondary));
  border-color: var(--theme-accent);
  box-shadow: 0 0 1.5vh var(--theme-glow);
}

.end-turn-btn {
  position: absolute;
  right: 2vw;
  bottom: 25vh;
  padding: 1.5vh 2vw;
  border-radius: 1vh;
  background: linear-gradient(135deg, var(--theme-secondary), var(--theme-accent));
  border: 0.3vh solid var(--theme-accent);
  color: white;
  font-size: 2vh;
  font-weight: bold;
  cursor: pointer;
  z-index: 50;
  transition: all 0.2s;
}
.end-turn-btn:hover {
  transform: translateY(-0.5vh);
  box-shadow: 0 0 2vh var(--theme-glow);
  background: linear-gradient(135deg, var(--theme-hover));
}

/* =========================================
   アニメーション定義
   ========================================= */
/* ドローアニメーション (画面右下から手札へ) */
.card-wrapper.drawing {
  pointer-events: none; 
  z-index: 1000; 
  animation: cardDrawIn 0.8s cubic-bezier(0, 0, 0.9, 1) both;
}
@keyframes cardDrawIn {
  0% { opacity: 0; transform: translate(40vw, 10vh) scale(0.2) rotate(45deg); }
  100% { opacity: 1; transform: translate(0, 0) scale(1) rotate(var(--rot)); }
}

/* 破棄アニメーション (左下へ吸い込まれる) */
.card-wrapper.discarding {
  pointer-events: none; 
  z-index: 1000;
  animation: discardToPile 0.6s cubic-bezier(0.8, -0.38, 0.035, 0.025) forwards;
}
@keyframes discardToPile {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: translate(-50vw, 1.5vh) scale(0.1) rotate(-90deg); }
}

/* --- モーダル全体 (オーバーレイ) --- */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.85); /* 背景を暗く */
  backdrop-filter: blur(5px); /* 背景をぼかす */
  z-index: 9999; /* 最前面 */
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.2s ease-out;
}

/* --- モーダルの中身 --- */
.modal-content {
  width: 80vw;
  max-width: 1000px;
  height: 80vh;
  background: var(--theme-bg);
  border: 0.4vh solid var(--theme-accent);
  border-radius: 2vh;
  box-shadow: 0 0 5vh var(--theme-glow);
  display: flex;
  flex-direction: column;
  padding: 2vh;
  animation: scaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* ヘッダー部分 */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2vh;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  padding-bottom: 1vh;
}

.modal-header h2 {
  font-size: 3vh;
  color: var(--theme-accent);
  text-shadow: 0 0 1vh var(--theme-glow);
  margin: 0;
}

.modal-close-btn {
  background: none;
  border: none;
  color: white;
  font-size: 4vh;
  cursor: pointer;
  line-height: 1;
}
.modal-close-btn:hover {
  color: var(--theme-accent);
}

/* ボディ部分 (スクロール可能に) */
.modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 1vh;
}

/* カードグリッド表示 */
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(11rem, 1fr));
  gap: 2rem;
  justify-items: center;
}

/* モーダル内のカードサイズ調整 */
.modal-card-wrapper {
  width: 11rem;
  height: 16rem;
  /* 手札のような回転はさせない */
  transform: scale(0.9); 
}

.empty-message {
  text-align: center;
  margin-top: 24vh;
  font-size: 7vh;
  color: #888;
}

/* アニメーション */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes scaleIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

/* =========================================
   剣気ゲージ (Sword Energy)
   ========================================= */
.sword-energy-display {
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 1vh;
  padding: 0.7vh 0.7vw;
  border: 0.2vh solid #ff6b35;
  border-radius: 1vh;
  background: rgba(0, 0, 0, 0.7);
  z-index: 50;
  min-width: 10vw;
}

.sword-energy-label {
  font-size: 1.8vh;
  font-weight: bold;
  color: #ff9f66;
  text-shadow: 0 0 0.5vh #ff6b35;
  margin: 0.2vh;
}

.sword-energy-bar-container {
  display: flex;
  align-items: center;
  gap: 1vw;
  width: 100%;
}

.sword-energy-bar {
  flex: 1;
  height: 2.5vh;
  background: rgba(0, 0, 0, 0.6);
  border: 0.2vh solid #ff6b35;
  border-radius: 0.5vh;
  position: relative;
  overflow: hidden;
}

.sword-energy-bonus {
  font-size: 1.4vh;
  font-weight: bold;
  color: #ffcc80;
  text-shadow: 0 0 0.5vh #ff6b35;
  white-space: nowrap;
}

.sword-energy-fill {
  height: 100%;
  background: linear-gradient(90deg, #ff6b35 0%, #ff9f66 50%, #ffcc80 100%);
  transition: width 0.3s ease;
  box-shadow: 0 0 1vh #ff6b35;
}

.sword-energy-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 1.5vh;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 0.5vh black;
}

.sword-energy-effects {
  display: flex;
  gap: 0.5vw;
  flex-wrap: wrap;
  justify-content: center;
}

.effect-badge {
  font-size: 1.2vh;
  padding: 0.2vh 0.5vw;
  border-radius: 0.3vh;
  font-weight: bold;
}

.effect-badge.crit {
  background: rgba(255, 215, 0, 0.3);
  border: 1px solid #ffd700;
  color: #ffd700;
}

.effect-badge.pierce {
  background: rgba(100, 200, 255, 0.3);
  border: 1px solid #64c8ff;
  color: #64c8ff;
}

.effect-badge.max {
  background: rgba(255, 50, 50, 0.4);
  border: 1px solid #ff3232;
  color: #ff3232;
  animation: maxEnergyPulse 0.5s ease-in-out infinite alternate;
}

@keyframes maxEnergyPulse {
  from {
    box-shadow: 0 0 0.5vh #ff3232;
    transform: scale(1);
  }
  to {
    box-shadow: 0 0 1.5vh #ff3232;
    transform: scale(1.1);
  }
}

/* =========================================
   敵表示セクション (Enemy Display)
   ========================================= */
.enemy-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 45%;
  height: 100%;
}

/* 1体レイアウト */
.enemy-layout-single {
  justify-content: center;
}

/* 2体レイアウト（横並び）*/
.enemy-layout-double .enemy-row {
  display: flex;
  gap: 3vw;
  justify-content: center;
  align-items: flex-end;
}

/* 3体レイアウト（三角形）*/
.enemy-layout-triple {
  justify-content: center;
  gap: 1vh;
}

.enemy-layout-triple .enemy-row-top {
  display: flex;
  justify-content: center;
}

.enemy-layout-triple .enemy-row-bottom {
  display: flex;
  gap: 4vw;
  justify-content: center;
}

/* 敵カード */
.enemy-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1vh;
  position: relative;
}

.enemy-card-small {
  transform: scale(0.75);
  transform-origin: center bottom;
}

.enemy-name {
  font-size: 2.5vh;
  font-weight: bold;
  text-shadow: 0 0 1vh var(--theme-glow);
  text-align: center;
}

.enemy-card-small .enemy-name {
  font-size: 2vh;
}

.enemy-visual {
  width: 18vh;
  height: 18vh;
  border-radius: 1.5vh;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.2s;
}

.enemy-visual:hover {
  transform: scale(1.05);
}

.enemy-card-small .enemy-visual {
  width: 14vh;
  height: 14vh;
}

.enemy-emoji {
  font-size: 10vh;
}

.enemy-card-small .enemy-emoji {
  font-size: 7vh;
}

.enemy-status {
  width: 100%;
  min-width: 16vh;
}

.enemy-card-small .enemy-status {
  min-width: 12vh;
}

/* 次の行動ツールチップ */
.next-action-tooltip {
  position: absolute;
  top: -2vh;
  left: 50%;
  transform: translateX(-50%) translateY(-100%);
  background: rgba(0, 0, 0, 0.95);
  border: 0.2vh solid var(--theme-accent);
  border-radius: 1vh;
  padding: 1vh 1.5vw;
  z-index: 1000;
  min-width: 12vw;
  box-shadow: 0 0 2vh var(--theme-glow);
  animation: tooltipFadeIn 0.2s ease-out;
}

@keyframes tooltipFadeIn {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-90%);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(-100%);
  }
}

.tooltip-header {
  font-size: 1.4vh;
  color: #888;
  margin-bottom: 0.5vh;
  text-align: center;
}

.tooltip-action-name {
  font-size: 2vh;
  font-weight: bold;
  color: var(--theme-accent);
  text-align: center;
  margin-bottom: 0.5vh;
}

.tooltip-damage {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5vw;
  font-size: 1.8vh;
  color: #ff6b6b;
}

.damage-icon {
  font-size: 1.6vh;
}

.damage-value {
  font-weight: bold;
}

.hit-count {
  font-size: 1.4vh;
  color: #ffaa44;
}

.tooltip-guard {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5vw;
  font-size: 1.8vh;
  color: #6bafff;
}

.guard-icon {
  font-size: 1.6vh;
}

.guard-value {
  font-weight: bold;
}

.tooltip-debuffs {
  display: flex;
  gap: 0.5vw;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 0.5vh;
}

.debuff-tag {
  font-size: 1.2vh;
  padding: 0.2vh 0.5vw;
  background: rgba(255, 100, 100, 0.3);
  border: 1px solid #ff6464;
  border-radius: 0.3vh;
  color: #ff6464;
}